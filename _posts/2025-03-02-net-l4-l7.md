---
layout: post
title: "L4和L7负载均衡技术理解"
date:   2025-3-2
tags: [网络]
comments: true
author: makalong
---

L4和L7表示是在OSI 层7层网络模型的哪一层去做负载均衡

L4表示是在运输层做负载均衡， 常见的是LVS， 在接收到客户端的包数据后，解析到目标IP和端口后，就转发到其中一台机器上，

L7是在应用层做负载均衡，常见的是Nginx, 在应用层可以拿到具体的传输数据，可以根据url去做负载， 也可以实现TLS终结， 就是Nginx网关解析tls后将数据透传给下游服务端，是完成的http, 而不是https, 既安全又有效率。

优缺点比较

- **L4（四层负载均衡）**

  工作在 OSI 七层模型的传输层进行负载均衡。传输层常见的协议有 TCP（传输控制协议）和 UDP（用户数据报协议）

  代表：LVS（Linux Virtual Server）是非常典型的四层负载均衡器。它在接收到客户端的数据包后，主要依据目标 IP 地址和端口号来决定将数据包转发到后端的哪一台服务器上。

  优点：由于只处理传输层及以下层次的信息，所以 L4 负载均衡的效率通常较高，能处理大量的并发连接，适合对性能要求较高的场景，如大规模的 Web 服务集群的前端负载均衡。

  缺点：L4 负载均衡虽然性能高，但灵活性相对较差，因为它只能通过IP地址和端口来做转发。

- **L7（七层负载均衡）**

  工作在 OSI 模型的应用层。应用层包含了各种应用协议，如 HTTP、HTTPS、FTP、SMTP 等。

  代表：Nginx是常用的七层负载均衡工具之一。

  优点：因为它可以解析应用层的数据，所以能够根据更丰富的信息进行负载均衡决策，比如根据 URL、请求头（如 User-Agent、Cookie 等）、请求方法（GET、POST 等）来分配请求。Nginx 可以作为 SSL/TLS 代理，在前端终止 SSL/TLS 连接，解密客户端发送的加密数据，然后将明文数据转发给后端服务器。这样做的好处是可以减轻后端服务器的 SSL/TLS 计算负担，提高整体系统的性能，同时也能保证数据在传输过程中的安全性（在客户端到 Nginx 之间是加密传输的）。

  缺点：L7 负载均衡虽然功能强大，但由于需要解析应用层数据，对性能有一定的影响，在处理高并发场景时可能不如 L4 负载均衡效率高。

  